<!DOCTYPE html>
<html>
<head>
  <title>Test Payment RLS Access</title>
</head>
<body>
  <h1>Testing Anonymous Payment Table Access</h1>
  <div id="results"></div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.1/dist/umd/supabase.min.js"></script>
  
  <script>
    const SUPABASE_URL = 'https://zlvnxvrzotamhpezqedr.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inpsdm54dnJ6b3RhbWhwZXpxZWRyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI4MTEzMTcsImV4cCI6MjA3ODM4NzMxN30.-IoSqKhDrA9NuG4j3GufIbfmodWqCoppEklE1nTmw38';
    
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    
    async function testAccess() {
      const results = document.getElementById('results');
      
      results.innerHTML += '<h2>Testing payment_records...</h2>';
      const { data: manualPayments, error: manualError } = await supabase
        .from('payment_records')
        .select('*')
        .limit(5);
      
      if (manualError) {
        results.innerHTML += `<p style="color:red">❌ ERROR: ${manualError.message}</p>`;
      } else {
        results.innerHTML += `<p style="color:green">✅ SUCCESS: Loaded ${manualPayments.length} payment_records</p>`;
      }
      
      results.innerHTML += '<h2>Testing payments (automated)...</h2>';
      const { data: automatedPayments, error: automatedError } = await supabase
        .from('payments')
        .select('*')
        .limit(5);
      
      if (automatedError) {
        results.innerHTML += `<p style="color:red">❌ ERROR: ${automatedError.message}</p>`;
      } else {
        results.innerHTML += `<p style="color:green">✅ SUCCESS: Loaded ${automatedPayments.length} payments</p>`;
        results.innerHTML += `<pre>${JSON.stringify(automatedPayments, null, 2)}</pre>`;
      }
      
      results.innerHTML += '<h2>Testing credit_payments...</h2>';
      const { data: creditPayments, error: creditError } = await supabase
        .from('credit_payments')
        .select('*')
        .limit(5);
      
      if (creditError) {
        results.innerHTML += `<p style="color:red">❌ ERROR: ${creditError.message}</p>`;
      } else {
        results.innerHTML += `<p style="color:green">✅ SUCCESS: Loaded ${creditPayments.length} credit_payments</p>`;
      }
    }
    
    testAccess();
  </script>
</body>
</html>
